{"jsonrpc":"2.0","result":{"contents":[{"uri":"resource://tooling/directory","mimeType":"text/plain","text":"{\"generated_at\":null,\"metrics_uri\":\"resource://tooling/metrics\",\"output_formats\":{\"default\":\"json\",\"tool_param\":\"format\",\"resource_query\":\"format\",\"values\":[\"json\",\"toon\"],\"toon_envelope\":{\"format\":\"toon\",\"data\":\"<TOON>\",\"meta\":{\"requested\":\"toon\"}}},\"clusters\":[{\"name\":\"Infrastructure & Workspace Setup\",\"purpose\":\"Bootstrap coordination and guardrails before agents begin editing.\",\"tools\":[{\"name\":\"ensure_project\",\"summary\":\"Ensure project slug, schema, and archive exist for a shared repo identifier.\",\"use_when\":\"First call against a repo or when switching projects.\",\"related\":[\"register_agent\",\"file_reservation_paths\"],\"expected_frequency\":\"Whenever a new repo/path is encountered.\",\"required_capabilities\":[\"infrastructure\",\"storage\"],\"usage_examples\":[{\"hint\":\"First action\",\"sample\":\"ensure_project(human_key='/abs/path/backend')\"}],\"capabilities\":[\"infrastructure\",\"storage\"],\"complexity\":\"low\"},{\"name\":\"install_precommit_guard\",\"summary\":\"Install Git pre-commit hook that enforces advisory file_reservations locally.\",\"use_when\":\"Onboarding a repository into coordinated mode.\",\"related\":[\"file_reservation_paths\",\"uninstall_precommit_guard\"],\"expected_frequency\":\"Infrequent—per repository setup.\",\"required_capabilities\":[\"infrastructure\",\"repository\"],\"usage_examples\":[{\"hint\":\"Onboard\",\"sample\":\"install_precommit_guard(project_key='backend', code_repo_path='~/repo')\"}],\"capabilities\":[\"infrastructure\",\"repository\"],\"complexity\":\"medium\"},{\"name\":\"uninstall_precommit_guard\",\"summary\":\"Remove the advisory pre-commit hook from a repo.\",\"use_when\":\"Decommissioning or debugging the guard hook.\",\"related\":[\"install_precommit_guard\"],\"expected_frequency\":\"Rare; only when disabling guard enforcement.\",\"required_capabilities\":[\"infrastructure\",\"repository\"],\"usage_examples\":[{\"hint\":\"Cleanup\",\"sample\":\"uninstall_precommit_guard(code_repo_path='~/repo')\"}],\"capabilities\":[\"infrastructure\",\"repository\"],\"complexity\":\"medium\"}]},{\"name\":\"Identity & Directory\",\"purpose\":\"Register agents, mint unique identities, and inspect directory metadata.\",\"tools\":[{\"name\":\"register_agent\",\"summary\":\"Upsert an agent profile and refresh last_active_ts for a known persona.\",\"use_when\":\"Resuming an identity or updating program/model/task metadata.\",\"related\":[\"create_agent_identity\",\"whois\"],\"expected_frequency\":\"At the start of each automated work session.\",\"required_capabilities\":[\"identity\"],\"usage_examples\":[{\"hint\":\"Resume persona\",\"sample\":\"register_agent(project_key='/abs/path/backend', program='codex', model='gpt5')\"}],\"capabilities\":[\"identity\"],\"complexity\":\"medium\"},{\"name\":\"create_agent_identity\",\"summary\":\"Always create a new unique agent name (optionally using a sanitized hint).\",\"use_when\":\"Spawning a brand-new helper that should not overwrite existing profiles.\",\"related\":[\"register_agent\"],\"expected_frequency\":\"When minting fresh, short-lived identities.\",\"required_capabilities\":[\"identity\"],\"usage_examples\":[{\"hint\":\"New helper\",\"sample\":\"create_agent_identity(project_key='backend', name_hint='GreenCastle', program='codex', model='gpt5')\"}],\"capabilities\":[\"identity\"],\"complexity\":\"medium\"},{\"name\":\"whois\",\"summary\":\"Return enriched profile info plus recent archive commits for an agent.\",\"use_when\":\"Dashboarding, routing coordination messages, or auditing activity.\",\"related\":[\"register_agent\"],\"expected_frequency\":\"Ad hoc when context about an agent is required.\",\"required_capabilities\":[\"audit\",\"identity\"],\"usage_examples\":[{\"hint\":\"Directory lookup\",\"sample\":\"whois(project_key='backend', agent_name='BlueLake')\"}],\"capabilities\":[\"audit\",\"identity\"],\"complexity\":\"medium\"},{\"name\":\"set_contact_policy\",\"summary\":\"Set inbound contact policy (open, auto, contacts_only, block_all).\",\"use_when\":\"Adjusting how permissive an agent is about unsolicited messages.\",\"related\":[\"request_contact\",\"respond_contact\"],\"expected_frequency\":\"Occasional configuration change.\",\"required_capabilities\":[\"configure\",\"contact\"],\"usage_examples\":[{\"hint\":\"Restrict inbox\",\"sample\":\"set_contact_policy(project_key='backend', agent_name='BlueLake', policy='contacts_only')\"}],\"capabilities\":[\"configure\",\"contact\"],\"complexity\":\"medium\"}]},{\"name\":\"Messaging Lifecycle\",\"purpose\":\"Send, receive, and acknowledge threaded Markdown mail.\",\"tools\":[{\"name\":\"send_message\",\"summary\":\"Deliver a new message with attachments, WebP conversion, and policy enforcement.\",\"use_when\":\"Starting new threads or broadcasting plans across projects.\",\"related\":[\"reply_message\",\"request_contact\"],\"expected_frequency\":\"Frequent—core write operation.\",\"required_capabilities\":[\"messaging\",\"write\"],\"usage_examples\":[{\"hint\":\"New plan\",\"sample\":\"send_message(project_key='backend', sender_name='GreenCastle', to=['BlueLake'], subject='Plan', body_md='...')\"}],\"capabilities\":[\"messaging\",\"write\"],\"complexity\":\"medium\"},{\"name\":\"reply_message\",\"summary\":\"Reply within an existing thread, inheriting flags and default recipients.\",\"use_when\":\"Continuing discussions or acknowledging decisions.\",\"related\":[\"send_message\"],\"expected_frequency\":\"Frequent when collaborating inside a thread.\",\"required_capabilities\":[\"messaging\",\"write\"],\"usage_examples\":[{\"hint\":\"Thread reply\",\"sample\":\"reply_message(project_key='backend', message_id=42, sender_name='BlueLake', body_md='Got it!')\"}],\"capabilities\":[\"messaging\",\"write\"],\"complexity\":\"medium\"},{\"name\":\"fetch_inbox\",\"summary\":\"Poll recent messages for an agent with filters (urgent_only, since_ts).\",\"use_when\":\"After each work unit to ingest coordination updates.\",\"related\":[\"mark_message_read\",\"acknowledge_message\"],\"expected_frequency\":\"Frequent polling in agent loops.\",\"required_capabilities\":[\"messaging\",\"read\"],\"usage_examples\":[{\"hint\":\"Poll\",\"sample\":\"fetch_inbox(project_key='backend', agent_name='BlueLake', since_ts='2025-10-24T00:00:00Z')\"}],\"capabilities\":[\"messaging\",\"read\"],\"complexity\":\"medium\"},{\"name\":\"mark_message_read\",\"summary\":\"Record read_ts for FYI messages without sending acknowledgements.\",\"use_when\":\"Clearing inbox notifications once reviewed.\",\"related\":[\"acknowledge_message\"],\"expected_frequency\":\"Whenever FYI mail is processed.\",\"required_capabilities\":[\"messaging\",\"read\"],\"usage_examples\":[{\"hint\":\"Read receipt\",\"sample\":\"mark_message_read(project_key='backend', agent_name='BlueLake', message_id=42)\"}],\"capabilities\":[\"messaging\",\"read\"],\"complexity\":\"medium\"},{\"name\":\"acknowledge_message\",\"summary\":\"Set read_ts and ack_ts so senders know action items landed.\",\"use_when\":\"Responding to ack_required messages.\",\"related\":[\"mark_message_read\"],\"expected_frequency\":\"Each time a message requests acknowledgement.\",\"required_capabilities\":[\"ack\",\"messaging\"],\"usage_examples\":[{\"hint\":\"Ack\",\"sample\":\"acknowledge_message(project_key='backend', agent_name='BlueLake', message_id=42)\"}],\"capabilities\":[\"ack\",\"messaging\"],\"complexity\":\"medium\"}]},{\"name\":\"Contact Governance\",\"purpose\":\"Manage messaging permissions when policies are not open by default.\",\"tools\":[{\"name\":\"request_contact\",\"summary\":\"Create or refresh a pending AgentLink and notify the target with ack_required intro.\",\"use_when\":\"Requesting permission before messaging another agent.\",\"related\":[\"respond_contact\",\"set_contact_policy\"],\"expected_frequency\":\"Occasional—when new communication lines are needed.\",\"required_capabilities\":[\"contact\"],\"usage_examples\":[{\"hint\":\"Ask permission\",\"sample\":\"request_contact(project_key='backend', from_agent='OpsBot', to_agent='BlueLake')\"}],\"capabilities\":[\"contact\"],\"complexity\":\"medium\"},{\"name\":\"respond_contact\",\"summary\":\"Approve or block a pending contact request, optionally setting expiry.\",\"use_when\":\"Granting or revoking messaging permissions.\",\"related\":[\"request_contact\"],\"expected_frequency\":\"As often as requests arrive.\",\"required_capabilities\":[\"contact\"],\"usage_examples\":[{\"hint\":\"Approve\",\"sample\":\"respond_contact(project_key='backend', to_agent='BlueLake', from_agent='OpsBot', accept=True)\"}],\"capabilities\":[\"contact\"],\"complexity\":\"medium\"},{\"name\":\"list_contacts\",\"summary\":\"List outbound contact links, statuses, and expirations for an agent.\",\"use_when\":\"Auditing who an agent may message or rotating expiring approvals.\",\"related\":[\"request_contact\",\"respond_contact\"],\"expected_frequency\":\"Periodic audits or dashboards.\",\"required_capabilities\":[\"audit\",\"contact\"],\"usage_examples\":[{\"hint\":\"Audit\",\"sample\":\"list_contacts(project_key='backend', agent_name='BlueLake')\"}],\"capabilities\":[\"audit\",\"contact\"],\"complexity\":\"medium\"}]},{\"name\":\"Search & Summaries\",\"purpose\":\"Surface signal from large mailboxes and compress long threads.\",\"tools\":[{\"name\":\"search_messages\",\"summary\":\"Run FTS5 queries across subject/body text to locate relevant threads.\",\"use_when\":\"Triage or gathering context before editing.\",\"related\":[\"fetch_inbox\",\"summarize_thread\"],\"expected_frequency\":\"Regular during investigation phases.\",\"required_capabilities\":[\"search\"],\"usage_examples\":[{\"hint\":\"FTS\",\"sample\":\"search_messages(project_key='backend', query='\\\"build plan\\\" AND users', limit=20)\"}],\"capabilities\":[\"search\"],\"complexity\":\"medium\"},{\"name\":\"summarize_thread\",\"summary\":\"Extract participants, key points, and action items for one or more threads.\",\"use_when\":\"Briefing new agents on long discussions, closing loops, or producing digests.\",\"related\":[\"search_messages\"],\"expected_frequency\":\"When threads exceed quick skim length or at cadence checkpoints.\",\"required_capabilities\":[\"search\",\"summarization\"],\"usage_examples\":[{\"hint\":\"Single thread\",\"sample\":\"summarize_thread(project_key='backend', thread_id='TKT-123', include_examples=True)\"},{\"hint\":\"Multi-thread digest\",\"sample\":\"summarize_thread(project_key='backend', thread_id='TKT-123,UX-42,BUG-99')\"}],\"capabilities\":[\"search\",\"summarization\"],\"complexity\":\"medium\"}]},{\"name\":\"File Reservations & Workspace Guardrails\",\"purpose\":\"Coordinate file/glob ownership to avoid overwriting concurrent work.\",\"tools\":[{\"name\":\"file_reservation_paths\",\"summary\":\"Issue advisory file_reservations with overlap detection and Git artifacts.\",\"use_when\":\"Before touching high-traffic surfaces or long-lived refactors.\",\"related\":[\"release_file_reservations\",\"renew_file_reservations\"],\"expected_frequency\":\"Whenever starting work on contested surfaces.\",\"required_capabilities\":[\"file_reservations\",\"repository\"],\"usage_examples\":[{\"hint\":\"Lock file\",\"sample\":\"file_reservation_paths(project_key='backend', agent_name='BlueLake', paths=['src/app.py'], ttl_seconds=7200)\"}],\"capabilities\":[\"file_reservations\",\"repository\"],\"complexity\":\"medium\"},{\"name\":\"release_file_reservations\",\"summary\":\"Release active file_reservations (fully or by subset) and stamp released_ts.\",\"use_when\":\"Finishing work so surfaces become available again.\",\"related\":[\"file_reservation_paths\",\"renew_file_reservations\"],\"expected_frequency\":\"Each time work on a surface completes.\",\"required_capabilities\":[\"file_reservations\"],\"usage_examples\":[{\"hint\":\"Unlock\",\"sample\":\"release_file_reservations(project_key='backend', agent_name='BlueLake', paths=['src/app.py'])\"}],\"capabilities\":[\"file_reservations\"],\"complexity\":\"medium\"},{\"name\":\"renew_file_reservations\",\"summary\":\"Extend file_reservation expiry windows without allocating new file_reservation IDs.\",\"use_when\":\"Long-running work needs more time but should retain ownership.\",\"related\":[\"file_reservation_paths\",\"release_file_reservations\"],\"expected_frequency\":\"Periodically during multi-hour work items.\",\"required_capabilities\":[\"file_reservations\"],\"usage_examples\":[{\"hint\":\"Extend\",\"sample\":\"renew_file_reservations(project_key='backend', agent_name='BlueLake', extend_seconds=1800)\"}],\"capabilities\":[\"file_reservations\"],\"complexity\":\"medium\"},{\"name\":\"force_release_file_reservation\",\"summary\":\"Force-release stale reservations after inactivity heuristics and optionally notify prior holders.\",\"use_when\":\"A reservation appears abandoned and is blocking progress.\",\"related\":[\"file_reservation_paths\",\"release_file_reservations\"],\"expected_frequency\":\"Rare; only for stuck reservations.\",\"required_capabilities\":[\"file_reservations\"],\"usage_examples\":[{\"hint\":\"Recover\",\"sample\":\"force_release_file_reservation(project_key='backend', agent_name='BlueLake', file_reservation_id=101)\"}],\"capabilities\":[\"file_reservations\"],\"complexity\":\"medium\"}]},{\"name\":\"Build Slots\",\"purpose\":\"Coordinate exclusive build/CI slots to avoid redundant runs.\",\"tools\":[{\"name\":\"acquire_build_slot\",\"summary\":\"Acquire an exclusive build slot for a project or scope.\",\"use_when\":\"Before starting a heavy build or CI run.\",\"related\":[\"renew_build_slot\",\"release_build_slot\"],\"expected_frequency\":\"Per build/CI task.\",\"required_capabilities\":[\"build\"],\"usage_examples\":[{\"hint\":\"Acquire\",\"sample\":\"acquire_build_slot(project_key='backend', agent_name='BlueLake')\"}],\"capabilities\":[\"build\"],\"complexity\":\"low\"},{\"name\":\"renew_build_slot\",\"summary\":\"Extend a build slot lease without re-acquiring.\",\"use_when\":\"Builds run longer than the original TTL.\",\"related\":[\"acquire_build_slot\",\"release_build_slot\"],\"expected_frequency\":\"As needed for long builds.\",\"required_capabilities\":[\"build\"],\"usage_examples\":[{\"hint\":\"Extend\",\"sample\":\"renew_build_slot(project_key='backend', agent_name='BlueLake', extend_seconds=600)\"}],\"capabilities\":[\"build\"],\"complexity\":\"low\"},{\"name\":\"release_build_slot\",\"summary\":\"Release a build slot when work is complete.\",\"use_when\":\"After build/CI finishes or is cancelled.\",\"related\":[\"acquire_build_slot\",\"renew_build_slot\"],\"expected_frequency\":\"At the end of each build/CI run.\",\"required_capabilities\":[\"build\"],\"usage_examples\":[{\"hint\":\"Release\",\"sample\":\"release_build_slot(project_key='backend', agent_name='BlueLake')\"}],\"capabilities\":[\"build\"],\"complexity\":\"low\"}]},{\"name\":\"Product Bus\",\"purpose\":\"Group projects into products and query messages across the product graph.\",\"tools\":[{\"name\":\"ensure_product\",\"summary\":\"Create or fetch a product record by UID or name.\",\"use_when\":\"Establishing a cross-project product grouping.\",\"related\":[\"products_link\"],\"expected_frequency\":\"Per product setup or migration.\",\"required_capabilities\":[\"product\"],\"usage_examples\":[{\"hint\":\"Create product\",\"sample\":\"ensure_product(product_uid='prod-123', name='Core')\"}],\"capabilities\":[\"product\"],\"complexity\":\"low\"},{\"name\":\"products_link\",\"summary\":\"Link a product to a project for cross-project views.\",\"use_when\":\"Associating a project with a product.\",\"related\":[\"ensure_product\"],\"expected_frequency\":\"Occasional; during project onboarding.\",\"required_capabilities\":[\"product\"],\"usage_examples\":[{\"hint\":\"Link\",\"sample\":\"products_link(product_uid='prod-123', project_key='/abs/path/backend')\"}],\"capabilities\":[\"product\"],\"complexity\":\"low\"},{\"name\":\"search_messages_product\",\"summary\":\"Search messages across all projects linked to a product.\",\"use_when\":\"Global search across a multi-repo product.\",\"related\":[\"fetch_inbox_product\",\"summarize_thread_product\"],\"expected_frequency\":\"Ad hoc during investigation or triage.\",\"required_capabilities\":[\"product\",\"search\"],\"usage_examples\":[{\"hint\":\"Search\",\"sample\":\"search_messages_product(product_uid='prod-123', query='outage')\"}],\"capabilities\":[\"product\",\"search\"],\"complexity\":\"medium\"},{\"name\":\"fetch_inbox_product\",\"summary\":\"Fetch inbox messages across all projects linked to a product.\",\"use_when\":\"Aggregating inbox visibility across a product portfolio.\",\"related\":[\"search_messages_product\"],\"expected_frequency\":\"Ad hoc when monitoring product-wide activity.\",\"required_capabilities\":[\"product\",\"messaging\"],\"usage_examples\":[{\"hint\":\"Inbox\",\"sample\":\"fetch_inbox_product(product_uid='prod-123', agent_name='BlueLake')\"}],\"capabilities\":[\"product\",\"messaging\"],\"complexity\":\"medium\"},{\"name\":\"summarize_thread_product\",\"summary\":\"Summarize a thread across product-linked projects.\",\"use_when\":\"Summarizing multi-project incidents.\",\"related\":[\"search_messages_product\"],\"expected_frequency\":\"When threads span multiple repos.\",\"required_capabilities\":[\"product\",\"summarization\"],\"usage_examples\":[{\"hint\":\"Summarize\",\"sample\":\"summarize_thread_product(product_uid='prod-123', thread_id='INC-42')\"}],\"capabilities\":[\"product\",\"summarization\"],\"complexity\":\"medium\"}]},{\"name\":\"Workflow Macros\",\"purpose\":\"Opinionated orchestrations that compose multiple primitives for smaller agents.\",\"tools\":[{\"name\":\"macro_start_session\",\"summary\":\"Ensure project, register/update agent, optionally file_reservation surfaces, and return inbox context.\",\"use_when\":\"Kickstarting a focused work session with one call.\",\"related\":[\"ensure_project\",\"register_agent\",\"file_reservation_paths\",\"fetch_inbox\"],\"expected_frequency\":\"At the beginning of each autonomous session.\",\"required_capabilities\":[\"file_reservations\",\"identity\",\"messaging\",\"workflow\"],\"usage_examples\":[{\"hint\":\"Bootstrap\",\"sample\":\"macro_start_session(human_key='/abs/path/backend', program='codex', model='gpt5', file_reservation_paths=['src/api/*.py'])\"}],\"capabilities\":[\"file_reservations\",\"identity\",\"messaging\",\"workflow\"],\"complexity\":\"medium\"},{\"name\":\"macro_prepare_thread\",\"summary\":\"Register or refresh an agent, summarise a thread, and fetch inbox context in one call.\",\"use_when\":\"Briefing a helper before joining an ongoing discussion.\",\"related\":[\"register_agent\",\"summarize_thread\",\"fetch_inbox\"],\"expected_frequency\":\"Whenever onboarding a new contributor to an active thread.\",\"required_capabilities\":[\"messaging\",\"summarization\",\"workflow\"],\"usage_examples\":[{\"hint\":\"Join thread\",\"sample\":\"macro_prepare_thread(project_key='backend', thread_id='TKT-123', program='codex', model='gpt5', agent_name='ThreadHelper')\"}],\"capabilities\":[\"messaging\",\"summarization\",\"workflow\"],\"complexity\":\"medium\"},{\"name\":\"macro_file_reservation_cycle\",\"summary\":\"FileReservation a set of paths and optionally release them once work is complete.\",\"use_when\":\"Wrapping a focused edit cycle that needs advisory locks.\",\"related\":[\"file_reservation_paths\",\"release_file_reservations\",\"renew_file_reservations\"],\"expected_frequency\":\"Per guarded work block.\",\"required_capabilities\":[\"file_reservations\",\"repository\",\"workflow\"],\"usage_examples\":[{\"hint\":\"FileReservation & release\",\"sample\":\"macro_file_reservation_cycle(project_key='backend', agent_name='BlueLake', paths=['src/app.py'], auto_release=true)\"}],\"capabilities\":[\"file_reservations\",\"repository\",\"workflow\"],\"complexity\":\"medium\"},{\"name\":\"macro_contact_handshake\",\"summary\":\"Request contact approval, optionally auto-accept, and send a welcome message.\",\"use_when\":\"Spinning up collaboration between two agents who lack permissions.\",\"related\":[\"request_contact\",\"respond_contact\",\"send_message\"],\"expected_frequency\":\"When onboarding new agent pairs.\",\"required_capabilities\":[\"contact\",\"messaging\",\"workflow\"],\"usage_examples\":[{\"hint\":\"Automated handshake\",\"sample\":\"macro_contact_handshake(project_key='backend', requester='OpsBot', target='BlueLake', auto_accept=true, welcome_subject='Hello', welcome_body='Excited to collaborate!')\"}],\"capabilities\":[\"contact\",\"messaging\",\"workflow\"],\"complexity\":\"medium\"}]}],\"playbooks\":[{\"workflow\":\"Kick off new agent session (macro)\",\"sequence\":[\"health_check\",\"macro_start_session\",\"summarize_thread\"]},{\"workflow\":\"Kick off new agent session (manual)\",\"sequence\":[\"health_check\",\"ensure_project\",\"register_agent\",\"fetch_inbox\"]},{\"workflow\":\"Start focused refactor\",\"sequence\":[\"ensure_project\",\"file_reservation_paths\",\"send_message\",\"fetch_inbox\",\"acknowledge_message\"]},{\"workflow\":\"Join existing discussion\",\"sequence\":[\"macro_prepare_thread\",\"reply_message\",\"acknowledge_message\"]},{\"workflow\":\"Manage contact approvals\",\"sequence\":[\"set_contact_policy\",\"request_contact\",\"respond_contact\",\"send_message\"]}]}"}]},"id":1}